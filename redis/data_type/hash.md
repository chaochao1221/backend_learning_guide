# 哈希

### 定义：

- REDIS_HASH（哈希表）是 HSET、HLEN 等命令的操作对象， 编码可以是 ziplist/REDIS_ENCODING_ZIPLIST（压缩列表作为底层实现） 或者 hashtable/REDIS_ENCODING_HT（字典作为底层实现）。

### 压缩列表编码的哈希对象

1. ziplist 编码的哈希对象使用压缩列表作为底层实现。每当有新的键值对要加入到哈希对象时，程序会先将保存了键的压缩列表节点推入到压缩列表表尾，然后再将保存了值的压缩列表节点推入到压缩列表表尾，因此：
   - 保存了同一键值对的两个节点总是紧挨在一起，保存键的节点在前，保存值的节点在后。
   - 先添加到哈希对象中的键值对会被放在压缩列表的表头方向，而后来添加到哈希对象中的键值对会被放在压缩列表的表尾方向。
   - 当进行查找/删除或更新操作时，程序先定位到键的位置，然后再通过对键的位置来定位值的位置。

### 字典编码的哈希对象

1. hashtable 编码的哈希对象使用字典作为底层实现。 程序将哈希表的键（key）保存为字典的键， 将哈希表的值（value）保存为字典的值。哈希表所使用的字典的键和值都是字符串对象。

### 编码的选择

1. 创建空白哈希表时， 程序默认使用 ziplist 编码， 当以下任何一个条件被满足时， 程序将编码从 ziplist 切换为 hashtable ：
   - 哈希表中某个键或某个值的长度大于 server.hash_max_ziplist_value （默认值为 64 ）。
   - 压缩列表中的节点数量大于 server.hash_max_ziplist_entries （默认值为 512 ）。

### 哈希命令的实现

1. 哈希类型命令的实现全都是对字典和压缩列表操作函数的包装， 以及几个在两种编码之间进行转换的函数。

